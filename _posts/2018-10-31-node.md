---
title: Node CTF Walkthrough
date: 2018-10-31
excerpt: "Write-up of Node 1 CTF"
tags: [ctf, cybersec, node.js, node, nmap]
---

Node is a CTF made by Rob Carr (rastating). Instead of relying on publicly available exploits, it features multiple security misconfigurations, a custom binary, and quite a few false leads along the way. It's marked as intermediate, and I feel that's accurate.

Kioptrix, while older, served as a good introduction to Find->Scan->Exploit. Node takes this further, in that you have use everything you can find to make smaller, more incremental steps.

## VM Setup
I'll be attacking this with Kali in VirtualBox.  Kali and Node are both on a NAT Network, with an IP range of 10.0.2.0/24.

## Discovery
I prefer Nmap's Ping Scan rather than netdiscover, but both work fine.

```bash
root@kali:~# nmap -sP 10.0.2.0/24
Starting Nmap 7.70 ( https://nmap.org ) at 2018-11-01 10:32 EDT
...
MAC Address: 08:00:27:4C:20:D2 (Oracle VirtualBox virtual NIC)
Nmap scan report for 10.0.2.7
Host is up (0.00021s latency).
...
Nmap done: 256 IP addresses (5 hosts up) scanned in 2.10 seconds
```

Target is 10.0.2.7.

## Port Scan
Back at it again with Nmap with these arguments:
* -p- All ports (1-65535)
* -sV Service Scan, taking guesses at what services are running on the target.
* -T4 Quick timing, but not overly aggressive.
* -sS Stealth SYN scan.
* -O  OS Detection.

```bash
root@kali:~# nmap -p- -sV -T4 -sS -O 10.0.2.7
Starting Nmap 7.70 ( https://nmap.org ) at 2018-11-01 10:38 EDT
Nmap scan report for 10.0.2.7
Host is up (0.00039s latency).
Not shown: 65533 filtered ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
3000/tcp open  http    Node.js Express framework
MAC Address: 08:00:27:A2:8A:95 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 132.48 seconds
```

## Website Enumeration
Since we only have port 22 (SSH) and Node.js on port 3000, let's see what Node is running.

OOh, a myspace knockoff. I like it.

<figure>
  <img src="{{ site.url }}{{ site.baseurl }}/assets/img/node/myplace.PNG" alt="">
  <figcaption>Myplace Home Page</figcaption>
</figure>

### Dirb & Nikto
As per usual with websites, we'll try a directory bruteforce attack to see if there's anything hidden.

```bash
root@kali:~# dirb http://10.0.2.7:3000

-----------------
DIRB v2.22
By The Dark Raver
-----------------

START_TIME: Thu Nov  1 11:21:07 2018
URL_BASE: http://10.0.2.7:3000/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://10.0.2.7:3000/ ----
(!) WARNING: NOT_FOUND[] page not stable, unable to determine the correct URLs {200}.
    (Try using FineTunning: '-f')

-----------------
END_TIME: Thu Nov  1 11:21:08 2018
DOWNLOADED: 0 - FOUND: 0
```

So, something is preventing dirb from working. Even with the -f flag, it fails to find anything. We'll try with Nikto and see if that fairs any better.

```bash
root@kali:~# nikto -host 10.0.2.7:3000
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.0.2.7
+ Target Hostname:    10.0.2.7
+ Target Port:        3000
+ Start Time:         2018-11-01 11:22:10 (GMT-4)
---------------------------------------------------------------------------
+ Server: No banner retrieved
+ Retrieved x-powered-by header: Express
+ Server leaks inodes via ETags, header found with file /, fields: 0xW/f15 0x15e4258ef70
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ OSVDB-3092: /app/: This might be interesting...
+ OSVDB-3092: /css: This might be interesting...
+ OSVDB-3092: /js: This might be interesting...
+ OSVDB-3092: /misc/: This might be interesting...
+ ERROR: Error limit (20) reached for host, giving up. Last error: error reading HTTP response
+ Scan terminated:  20 error(s) and 9 item(s) reported on remote host
+ End Time:           2018-11-01 11:22:48 (GMT-4) (38 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

Nikto called it quits due to failures, likely with what's messing with Dirb. However, we were still able to enumerate some directories. Upon trying to go to any of those directories, it redirects to the home page. Oh well, let's see what's in the page source.

### Source Code
Most of the page source consists of the frontend; however, there are lots of Javascript files linked at the bottom:

<figure>
  <img src="{{ site.url }}{{ site.baseurl }}/assets/img/node/js_files.PNG" alt="">
  <figcaption>Linked Javascript files</figcaption>
</figure>

We can likely ignore jquery, bootstrap, freelancer, and angular, given they are minimized files and three are from the vendor. (Though, I suppose a cunning individual could replace them with custom code.)

For now, let's look at each file under assets/js/app:

#### App.js


## API Calls
### Burp


## User Hashes
### HashID
### John
### Loggin In

## Backup?
### Examination
### Zip Cracking
### Enumerating (app.js)

## SSH as Mark
### System Enumeration
### Scheduler

## Switching to Tom

## Secure Backup 1.0
### Analysis
### Using SetUID to our advantage

## Conclusions
